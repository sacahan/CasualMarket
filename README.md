# CasualMarket

å°ç£è‚¡åƒ¹å³æ™‚æŸ¥è©¢ MCP Serverï¼Œæä¾›é€é Model Context Protocol å­˜å–å°ç£è­‰åˆ¸äº¤æ˜“æ‰€å³æ™‚è‚¡åƒ¹è³‡è¨Šçš„åŠŸèƒ½ã€‚åŸºæ–¼ FastMCP æ¡†æ¶é–‹ç™¼ï¼Œå…·å‚™æ™ºèƒ½é€Ÿç‡é™åˆ¶ã€å¿«å–æ©Ÿåˆ¶å’Œé€²éšè²¡å‹™åˆ†æåŠŸèƒ½ã€‚

## âœ¨ Features

### æ ¸å¿ƒåŠŸèƒ½

- ğŸ“ˆ **å³æ™‚è‚¡åƒ¹æŸ¥è©¢** - æ”¯æ´å°ç£è­‰åˆ¸äº¤æ˜“æ‰€å³æ™‚è‚¡åƒ¹è³‡è¨Š
- ğŸ” **æ™ºèƒ½æŸ¥è©¢** - æ”¯æ´è‚¡ç¥¨ä»£ç¢¼ (2330) å’Œå…¬å¸åç¨± ("å°ç©é›»") æŸ¥è©¢
- âš¡ **é€Ÿç‡é™åˆ¶èˆ‡å¿«å–** - å…§å»º API é »ç‡é™åˆ¶å’Œæ™ºèƒ½å¿«å–æ©Ÿåˆ¶
- ğŸ’° **æ¨¡æ“¬äº¤æ˜“** - å®Œæ•´çš„è‚¡ç¥¨è²·è³£æ¨¡æ“¬åŠŸèƒ½ (æœ€å° 1000 è‚¡å–®ä½)
- ğŸ“Š **è²¡å‹™å ±è¡¨åˆ†æ** - æç›Šè¡¨ã€è³‡ç”¢è² å‚µè¡¨å’Œå…¬å¸åŸºæœ¬è³‡è¨ŠæŸ¥è©¢
- ğŸ›¡ï¸ **å®¹éŒ¯æ©Ÿåˆ¶** - æ™ºèƒ½å¿«å–å’ŒéŒ¯èª¤è™•ç†æ©Ÿåˆ¶ç¢ºä¿æœå‹™ç©©å®šæ€§

### æŠ€è¡“ç‰¹è‰²

- ğŸš€ **FastMCP æ•´åˆ** - ä½¿ç”¨ `@mcp.tool` è£é£¾å™¨ç°¡åŒ–å·¥å…·è¨»å†Š
- ğŸ—„ï¸ **æœ¬åœ°è­‰åˆ¸è³‡æ–™åº«** - SQLite è³‡æ–™åº«å­˜å„² ISIN ä»£ç¢¼å’Œå…¬å¸åç¨±æ˜ å°„
- âš¡ **è£é£¾å™¨å¢å¼·** - ä½¿ç”¨å‡½æ•¸è£é£¾å™¨ç‚º API æ–¹æ³•æ·»åŠ å¿«å–å’Œé€Ÿç‡é™åˆ¶
- ğŸ“ **å®Œæ•´é¡å‹æ”¯æ´** - ä½¿ç”¨ Pydantic æ¨¡å‹é€²è¡Œæ•¸æ“šé©—è­‰å’Œåºåˆ—åŒ–
- ğŸ§ª **å®Œå–„æ¸¬è©¦** - è¦†è“‹ç‡ >80%ï¼ŒåŒ…å« API æ•´åˆå’Œ MCP å”è­°æ¸¬è©¦

## ğŸš€ Installation & Usage

### å¿«é€Ÿå•Ÿå‹•

```bash
# ä½¿ç”¨ uvx å•Ÿå‹• MCP ä¼ºæœå™¨ (æ¨è–¦)
uvx --from . casual-market-mcp

# æˆ–ä½¿ç”¨é–‹ç™¼æ¨¡å¼
uv run python src/main.py
```

### Claude Desktop è¨­å®š

åœ¨ Claude Desktop é…ç½®æª”ä¸­æ·»åŠ ï¼š

```json
{
  "mcpServers": {
    "casual-market": {
      "command": "uvx",
      "args": ["--from", "/path/to/CasualMarket", "casual-market-mcp"],
      "env": {
        "LOG_LEVEL": "INFO"
      }
    }
  }
}
```

## ğŸ› ï¸ MCP Tools

| å·¥å…·åç¨±                       | åŠŸèƒ½æè¿°             | æ”¯æ´è¼¸å…¥               |
| ------------------------------ | -------------------- | ---------------------- |
| `get_taiwan_stock_price`       | æŸ¥è©¢å°ç£è‚¡ç¥¨å³æ™‚åƒ¹æ ¼ | è‚¡ç¥¨ä»£ç¢¼æˆ–å…¬å¸åç¨±     |
| `buy_taiwan_stock`             | æ¨¡æ“¬è‚¡ç¥¨è²·å…¥æ“ä½œ     | ä»£ç¢¼ã€è‚¡æ•¸ã€åƒ¹æ ¼(å¯é¸) |
| `sell_taiwan_stock`            | æ¨¡æ“¬è‚¡ç¥¨è³£å‡ºæ“ä½œ     | ä»£ç¢¼ã€è‚¡æ•¸ã€åƒ¹æ ¼(å¯é¸) |
| `get_company_income_statement` | å–å¾—å…¬å¸ç¶œåˆæç›Šè¡¨   | è‚¡ç¥¨ä»£ç¢¼               |
| `get_company_balance_sheet`    | å–å¾—å…¬å¸è³‡ç”¢è² å‚µè¡¨   | è‚¡ç¥¨ä»£ç¢¼               |
| `get_company_profile`          | å–å¾—å…¬å¸åŸºæœ¬è³‡è¨Š     | è‚¡ç¥¨ä»£ç¢¼               |

### ä½¿ç”¨ç¯„ä¾‹

```python
# æŸ¥è©¢å°ç©é›»è‚¡åƒ¹ (æ”¯æ´ä»£ç¢¼æˆ–å…¬å¸åç¨±)
await get_taiwan_stock_price("2330")
await get_taiwan_stock_price("å°ç©é›»")

# æ¨¡æ“¬è²·å…¥ 1000 è‚¡å°ç©é›»
await buy_taiwan_stock("2330", 1000)

# æŸ¥è©¢å…¬å¸è²¡å‹™å ±è¡¨
await get_company_income_statement("2330")
```

## ğŸ—ï¸ Architecture

### å°ˆæ¡ˆçµæ§‹

```
src/
â”œâ”€â”€ api/                    # API å®¢æˆ¶ç«¯å±¤
â”‚   â”œâ”€â”€ twse_client.py     # æ¨™æº– TWSE API æ•´åˆ
â”‚   â”œâ”€â”€ openapi_client.py  # OpenAPI è²¡å‹™å ±è¡¨å®¢æˆ¶ç«¯
â”‚   â””â”€â”€ decorators.py      # API è£é£¾å™¨å’Œé‡è©¦é‚è¼¯
â”œâ”€â”€ cache/                  # å¿«å–å’Œé€Ÿç‡é™åˆ¶
â”‚   â”œâ”€â”€ rate_limited_cache_service.py
â”‚   â””â”€â”€ cache_manager.py
â”œâ”€â”€ models/                 # è³‡æ–™æ¨¡å‹
â”‚   â”œâ”€â”€ stock_data.py      # è‚¡ç¥¨è³‡æ–™æ¨¡å‹
â”‚   â””â”€â”€ trading_models.py  # äº¤æ˜“æ“ä½œæ¨¡å‹
â”œâ”€â”€ tools/analysis/         # è²¡å‹™åˆ†æå·¥å…·
â”‚   â””â”€â”€ financials.py      # è²¡å‹™åˆ†ææ ¸å¿ƒé‚è¼¯
â”œâ”€â”€ scrapers/              # è³‡æ–™çˆ¬èŸ²
â”‚   â””â”€â”€ twse_isin_scraper.py
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•¸
â”œâ”€â”€ server.py              # FastMCP ä¼ºæœå™¨ä¸»ç¨‹å¼
â”œâ”€â”€ securities_db.py       # è­‰åˆ¸è³‡æ–™åº«ç®¡ç†
â””â”€â”€ main.py               # æ‡‰ç”¨ç¨‹å¼é€²å…¥é»
```

### æ ¸å¿ƒæ¶æ§‹æ¨¡å¼

- **FastMCP æ•´åˆ**: ä½¿ç”¨ `@mcp.tool` è£é£¾å™¨å–ä»£å‚³çµ± MCP ä¼ºæœå™¨è¨­å®š
- **è£é£¾å™¨å¢å¼·**: ä½¿ç”¨ `@with_cache` è£é£¾å™¨ç‚º API æ–¹æ³•æ·»åŠ å¿«å–å’Œé€Ÿç‡é™åˆ¶
- **é€Ÿç‡é™åˆ¶å¿«å–**: æ‰€æœ‰ API å‘¼å«é€é `RateLimitedCacheService` é˜²æ­¢ API æ¿«ç”¨
- **åˆ†å±¤é©—è­‰**: å¤šå±¤ç´šè¼¸å…¥é©—è­‰ (ç¬¦è™Ÿæ ¼å¼ã€å¸‚å ´é¡å‹ã€API å›æ‡‰)
- **å…¬å¸åç¨±è§£æ**: é€éæœ¬åœ° SQLite è³‡æ–™åº«æ”¯æ´ä»£ç¢¼å’Œåç¨±æŸ¥è©¢
- **æ¨¡çµ„åŒ–å·¥å…·è¨­è¨ˆ**: è²¡å‹™åˆ†æå·¥å…·æ¡ç”¨ç›¸ä¾æ³¨å…¥çš„å¯æ’æ‹”çµ„ä»¶

## ğŸ§ª Development

### æ¸¬è©¦

```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
uv run pytest

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦é¡åˆ¥
uv run pytest tests/api/           # API æ•´åˆæ¸¬è©¦
uv run pytest tests/server/        # ä¼ºæœå™¨åŠŸèƒ½æ¸¬è©¦
uv run pytest tests/mcp/           # MCP å”è­°æ¸¬è©¦
uv run pytest tests/tools/         # å·¥å…·åŠŸèƒ½æ¸¬è©¦

# åŸ·è¡Œå–®ä¸€æ¸¬è©¦æª”æ¡ˆ
uv run pytest tests/api/test_twse_standalone.py

# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
uv run pytest --cov=src --cov-report=html
```

### ç¨‹å¼ç¢¼å“è³ª

```bash
# ç¨‹å¼ç¢¼æª¢æŸ¥
uv run ruff check src/ tests/

# é¡å‹æª¢æŸ¥
uv run mypy src/

# è‡ªå‹•ä¿®å¾©å¯ä¿®å¾©çš„å•é¡Œ
uv run ruff check --fix src/ tests/
```

### é–‹ç™¼ç’°å¢ƒé©—è­‰

```bash
# æ¸¬è©¦ uvx åŸ·è¡Œå’Œ MCP å”è­°
./tests/test_uvx_execution.sh

# æ¸¬è©¦å¢å¼·å®¢æˆ¶ç«¯åŠŸèƒ½
uv run python tests/api/demo_enhanced_client.py

# API åŠŸèƒ½é™¤éŒ¯
uv run python tests/api/debug_api.py
```

## âš™ï¸ Configuration

### ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸åç¨±                  | é è¨­å€¼ | æè¿°              |
| ------------------------- | ------ | ----------------- |
| `MARKET_MCP_API_TIMEOUT`  | 10s    | API è«‹æ±‚è¶…æ™‚æ™‚é–“  |
| `MARKET_MCP_API_RETRIES`  | 5      | é‡è©¦æ¬¡æ•¸          |
| `MARKET_MCP_TWSE_API_URL` | -      | TWSE API ç«¯é» URL |
| `LOG_LEVEL`               | INFO   | æ—¥èªŒç´šåˆ¥          |

### è³‡æ–™åº«ç®¡ç†

- **è­‰åˆ¸è³‡æ–™åº«**: `src/twse_securities.db` åŒ…å« ISIN ä»£ç¢¼å’Œå…¬å¸åç¨±æ˜ å°„
- **è³‡æ–™åº«æ›´æ–°**: ä½¿ç”¨ `src/scrapers/` ä¸­çš„çˆ¬èŸ²æ›´æ–°å…¬å¸è³‡æ–™
- **å…¬å¸åç¨±è§£æ**: é€é `securities_db.py` æ¨¡çµ„è‡ªå‹•è™•ç†
- **æ¸¬è©¦è³‡æ–™åº«**: æ¸¬è©¦æœŸé–“ä½¿ç”¨ç¨ç«‹çš„æ¸¬è©¦è³‡æ–™åº«é¿å…è¡çª

## ğŸ“„ License

MIT License - è©³è¦‹ [LICENSE](LICENSE) æª”æ¡ˆã€‚

## ğŸ“š Documentation

- [ç¼ºå°‘å·¥å…·å¯¦ä½œæ¸…å–®](docs/MISSING_TOOLS_IMPLEMENTATION.md) - å°šæœªå¯¦ä½œçš„ TWSEMCPServer å·¥å…·åŠŸèƒ½

## ğŸ¤ Contributing

æ­¡è¿æäº¤ Issue å’Œ Pull Requestï¼è«‹ç¢ºä¿ï¼š

1. éµå¾ªç¾æœ‰çš„ç¨‹å¼ç¢¼é¢¨æ ¼
2. æ·»åŠ é©ç•¶çš„æ¸¬è©¦
3. æ›´æ–°ç›¸é—œæ–‡ä»¶
4. é€šéæ‰€æœ‰å“è³ªæª¢æŸ¥

---

**æ³¨æ„**: æœ¬å°ˆæ¡ˆåƒ…ä¾›æ•™è‚²å’Œç ”ç©¶ç”¨é€”ï¼Œä¸æ§‹æˆæŠ•è³‡å»ºè­°ã€‚æ¨¡æ“¬äº¤æ˜“åŠŸèƒ½åƒ…ç”¨æ–¼æ¸¬è©¦ï¼Œä¸æ¶‰åŠçœŸå¯¦è³‡é‡‘äº¤æ˜“ã€‚
